<section class="welcome-section">
    <script>
        function backupBase64() {
            const json = JSON.stringify(localStorage);
            const base64 = btoa(unescape(encodeURIComponent(json))); // Encode to UTF-8-safe base64
            const blob = new Blob([base64], { type: "text/plain" });

            const a = document.createElement("a");
            a.href = URL.createObjectURL(blob);
            a.download = "backup.bak"; // ğŸ” Totally looks serious now
            a.click();

            URL.revokeObjectURL(a.href);
        }
        
        function restoreBase64(event) {
            const file = event.target.files[0];
            if (!file) return;

            const reader = new FileReader();
            reader.onload = function (e) {
                try {
                    const base64 = e.target.result;
                    const json = decodeURIComponent(escape(atob(base64)));
                    const data = JSON.parse(json);

                    for (let key in data) {
                        localStorage.setItem(key, data[key]);
                    }

                    alert("âœ… è³‡æ–™é‚„åŸæˆåŠŸï¼è‹¥åœ¨æ‡‰ç”¨ç¨‹å¼ä¸Šï¼Œè«‹å®Œå…¨é—œé–‰ä¸¦é‡é–‹ã€‚");
                } catch (err) {
                    alert("âŒ å‚™ä»½æª”æ¡ˆéŒ¯èª¤æˆ–å·²æå£ã€‚");
                    console.error(err);
                }
            };

            reader.readAsText(file);
        }
    </script>
    <div style="margin: 20px; text-align: center;">
        <button data-i18n="backupBtn" id="backupbtn" onclick="backupBase64()">Backup</button>
        &nbsp;&nbsp;&nbsp;
        <label for="file-upload" class="custom-file-upload" data-i18n="restoreBtn">
            å‚™ä»½
        </label>
        <input id="file-upload" type="file" accept=".bak,.txt" onchange="restoreBase64(event)" style="display:none;">
    </div>
    <div class="boxxxxxx">
        <h2 data-i18n="inventory">INVENTORY</h2>
        <div class="boxxxxxx" style="width: auto; display: flex; justify-content: space-evenly;" id="inventory-box-div">

        </div>
        <script>
            localStorage.getItem("priorreply") && $("#inventory-box-div").append(`
                <div class="perk-box">
                    <img src="perks/priorreply.svg" alt="Prior Reply" class="perk-img" style="width: 100px;">
                </div>
            `);
            localStorage.getItem("supercomment") && $("#inventory-box-div").append(`
                <div class="perk-box">
                    <img src="perks/supercomment.svg" alt="Super Comment" class="perk-img" style="width: 100px;">
                </div>
            `);
            localStorage.getItem("websiteskin") && $("#inventory-box-div").append(`
                <div class="perk-box">
                    <img src="perks/skin.svg" alt="Website Skin" class="perk-img" style="width: 100px;">
                </div>
            `);
            localStorage.getItem("betaticket") && $("#inventory-box-div").append(`
                <div class="perk-box">
                    <img src="perks/earlyview.svg" alt="Beta Ticket" class="perk-img" style="width: 100px;">
                </div>
            `);
        </script>
    </div>
    <br>
    <div class="boxxxxxx">
        <h2 data-i18n="scoreboard">BANK</h2>
        <p style="font-style: italic;" data-i18n="scoreboard-notice">Activity started on 2025/5/17, does not include staff.</p><br>
        <table class="fancy-table">
            <colgroup>
                <col style="width: 10%;">
                <col style="width: 50%;">
                <col style="width: 40%;">
            </colgroup>
            <thead>
                <tr>
                    <th>&num;</th>
                    <th data-i18n="ranking-name">Name</th>
                    <th data-i18n="scores">Points</th>
                </tr>
            </thead>
            <tbody id="ranking-tbody">
                
            </tbody>
        </table>
    </div>
    <script>
        function sortData(data) {
            return data.sort((a, b) => b.points - a.points);
        }

        function displayTable(data) {
            const tbody = $("#ranking-tbody");
            tbody.empty();

            data.forEach((item, index) => {
                console.log("append row:", item.name, item.points); // Debug log
                tbody.append(`
                    <tr>
                        <td>${index + 1}</td>
                        <td>${item.name}</td>
                        <td>${item.points}</td>
                    </tr>
                `);
            });
        }

        fetch('ranking.json')
            .then(response => response.json())
            .then(data => {
                const sortedData = sortData(data);
                displayTable(sortedData);
            })
            .catch(error => console.error('Error fetching JSON:', error));
    </script>
    <br>
    <div class="boxxxxxx">
        <h2 data-i18n="warn-list">Warning List</h2>
        <table class="fancy-table">
            <colgroup>
                <col style="width: 10%;">
                <col style="width: 50%;">
                <col style="width: 40%;">
            </colgroup>
            <thead>
                <tr>
                    <th>&num;</th>
                    <th data-i18n="ranking-name">Name</th>
                    <th data-i18n="warns-num">Warns</th>
                    <th data-i18n="warn-status">Status</th>
                </tr>
            </thead>
            <tbody id="ranking-tbody">
                <tr>
                    <td>1</td>
                    <td>Jeffrey Wang</td>
                    <td>1</td>
                    <td data-i18n="warning">Warning</td>
                    <!-- Edit other people's slide -->
                </tr>
            </tbody>
        </table>
    </div>
    <br>
    <div class="boxxxxxx" style="text-align: center;">
        <h2 data-i18n="perks-rules">Exchange Rules</h2>
        <label for="exchange-serial"></label>
        <input type="text" name="exchange-serial" id="exchange-serial" placeholder="CODE" style="width: 300px; padding: 10px; font-size: 16px;">
        <button id="exchange-button" style="padding: 10px; font-size: 16px;">OK</button>
        <script>
            $("#exchange-button").click(function() {
                const perks = {
                    "1": "priorreply",
                    "2": "supercomment",
                    "3": "websiteskin",
                    "4": "betaticket"
                }
                const serial = $("#exchange-serial").val().trim();
                if (serial === "") {
                    alert("Please enter a valid exchange code.");
                    return;
                }
                let decoded = "";
                try {
                    decoded = atob(atob(serial)).split("|"); // Double decode
                } catch {
                    alert("Please enter a valid exchange code.");
                    return;
                }
                // check for cheaters
                if ((localStorage.getItem(perks[decoded[3].toString()]) ? JSON.parse(localStorage.getItem(perks[decoded[3].toString()])).code_used : []).includes(serial)) {
                    alert("You have already redeemed this code. Error code: REPEP_REDEEM");
                    return;
                }
                if ((localStorage.getItem("redeemed") ? JSON.parse(localStorage.getItem("redeemed")) : []).includes(serial)) {
                    alert("You have already redeemed this code. Error code: REPEP_REDEEM");
                    return;
                }
                // perform checksums
                if (decoded.length !== 5 || decoded[0] !== "VERIFIED") {
                    alert("Invalid exchange code. Contact us for help if the code is what we gave you. Error code: INVALID_UNVERIFIED");
                    return;
                }
                // check expiration
                if (new Date(decoded[1]) < Date.now()) {
                    alert("This exchange code has expired. Please contact us for a new one. Error code: EXPIRED");
                    return;
                }
                // check perk
                if ([5, 6, 7, 8].includes(parseInt(decoded[3]))) {
                    alert(`We probably gave you the wrong code. Please contact us for help. Error code: WRONG_PERK${parseInt(decoded[3])}`);
                    return;
                }
                // check quant
                try {
                    parseInt(decoded[4]);
                } catch (e) {
                    alert("Invalid quantity in the exchange code. Contact us for help if the code is what we gave you. Error code: INVALID_QUANT");
                    return;
                }

                // give perk
                const used = localStorage.getItem(perks[decoded[3].toString()]) ? JSON.parse(localStorage.getItem(perks[decoded[3].toString()])).code_used : "";
                localStorage.setItem(perks[decoded[3].toString()], JSON.stringify({
                    id: decoded[3],
                    redeemedAt: Date.now(),
                    code_used: used + serial,
                }));
                let redeemed = localStorage.getItem("redeemed") ? JSON.parse(localStorage.getItem("redeemed")) : [];
                redeemed.push(serial);
                localStorage.setItem("redeemed", JSON.stringify(redeemed));
                alert(`You have successfully redeemed the perk with ID ${decoded[3]}!`);

                $("#exchange-serial").val(""); // Clear input after exchange
            });
        </script>
        <br><br>
        <div class="boxxxxxx" style="width: 100%; text-align: left;">
            <h3>Store å•†åº—</h3>
            <div class="boxxxxxx" style="display: flex; width: 100%; overflow: auto;">
                <div style="flex: 0 0 25%; max-width: 25%;">
                    <img src="perks/priorreply.svg" alt="Priority Reply" style="width: 100%;" class="perk-img">
                </div>
                <div style="
                    flex: 1;
                    margin-left: 20px;
                    display: flex;
                    flex-direction: column;
                    align-items: flex-start;
                    justify-content: flex-start;
                    text-align: left;
                ">
                    <h3 style="font-size: 35px; margin: 0;">å„ªå…ˆå›è¦† Prior Replies</h3>
                    <p style="margin: 0; font-size: 15px;">ID: 1 &nbsp;&nbsp;&nbsp; 10pts</p>
                    <p style="margin: 0; font-size: 20px;">
                        æˆ‘å€‘é€šå¸¸è¦1~3å¤©æ‰æœƒæŠŠç•™è¨€å¯©æ ¸å®Œç•¢ï¼Œæœ‰é€™å€‹å°±å¯ä»¥æ›´å¿«ã€‚å¦å¤–ï¼Œé€™ä¹Ÿå¯ä»¥è®“ä½ å¾—åˆ°å„ªå…ˆçš„ç•™è¨€å›è¦†! You can get earlier replies from us and faster processing time!
                    </p>
                </div>
            </div><br>
            <div class="boxxxxxx" style="display: flex; width: 100%; overflow: auto;">
                <div style="flex: 0 0 25%; max-width: 25%;">
                    <img src="perks/supercomment.svg" alt="Super Comment" style="width: 100%;" class="perk-img">
                </div>
                <div style="
                    flex: 1;
                    margin-left: 20px;
                    display: flex;
                    flex-direction: column;
                    align-items: flex-start;
                    justify-content: flex-start;
                    text-align: left;
                ">
                    <h3 style="font-size: 35px; margin: 0;">è¶…ç´šç•™è¨€ Super Comment</h3>
                    <p style="margin: 0; font-size: 15px;">ID: 2 &nbsp;&nbsp;&nbsp; 20pts</p>
                    <p style="margin: 0; font-size: 20px;">
                        é€™å€‹å¯ä»¥è®“ä½ çš„ç•™è¨€ç½®é ‚ï¼Œä¹Ÿå¯ä»¥è‡ªå·±é¸é¡è‰²å’Œé ­åƒï¼Œç‰¹åˆ¥çš„æ˜é¡¯ã€‚å¾—åˆ°çš„åˆ†æ•¸ä¹Ÿæœƒä¾ç…§ç•™è¨€å…§å®¹å¢åŠ å–”! Your comments will be more customizable and stay at the top!
                    </p>
                </div>
            </div><br>
            <div class="boxxxxxx" style="display: flex; width: 100%; overflow: auto;">
                <div style="flex: 0 0 25%; max-width: 25%;">
                    <img src="perks/skin.svg" alt="Skin" style="width: 100%;" class="perk-img">
                </div>
                <div style="
                    flex: 1;
                    margin-left: 20px;
                    display: flex;
                    flex-direction: column;
                    align-items: flex-start;
                    justify-content: flex-start;
                    text-align: left;
                ">
                    <h3 style="font-size: 35px; margin: 0;">ç¶²ç«™çš®è†š Website "Skin"</h3>
                    <p style="margin: 0; font-size: 15px;">ID: 3 &nbsp;&nbsp;&nbsp; 20pts</p>
                    <p style="margin: 0; font-size: 20px;">
                        çé …æ¨¡ä»¿ç©é›»ç©çš„è®€è€…å€‘ï¼Œå¯ä»¥æä¾›åœ–ç‰‡é€£çµï¼Œå–ä»£åŸæœ¬ä¸Šæ–¹çš„åœ–æ›¸æ«ƒåœ–ç‰‡! You can provide a link to an image to replace the bookshelf image at the top of the page!
                    </p>
                </div>
            </div><br>
            <div class="boxxxxxx" style="display: flex; width: 100%; overflow: auto;">
                <div style="flex: 0 0 25%; max-width: 25%;">
                    <img src="perks/earlyview.svg" alt="Beta Ticket" style="width: 100%;" class="perk-img">
                </div>
                <div style="
                    flex: 1;
                    margin-left: 20px;
                    display: flex;
                    flex-direction: column;
                    align-items: flex-start;
                    justify-content: flex-start;
                    text-align: left;
                ">
                    <h3 style="font-size: 35px; margin: 0;">è©¦é–±æ–°åˆŠ Beta Access</h3>
                    <p style="margin: 0; font-size: 15px;">ID: 4 &nbsp;&nbsp;&nbsp; 35pts</p>
                    <p style="margin: 0; font-size: 20px;">
                        é€™æ¨£å°±å¯ä»¥å…ˆçœ‹é‚„åœ¨è£½ä½œä¸­çš„æ–°é€±åˆŠï¼Œä¾‹å¦‚ä¸‹ä¸€æœŸçš„é€±åˆŠæå‰çœ‹ç­‰ã€‚You can now see beta magazines!
                    </p>
                </div>
            </div><br>
            <div class="boxxxxxx" style="display: flex; width: 100%; overflow: auto;">
                <div style="flex: 0 0 25%; max-width: 25%;">
                    <img src="perks/bigdecision.svg" alt="Big Decision" style="width: 100%;" class="perk-img">
                </div>
                <div style="
                    flex: 1;
                    margin-left: 20px;
                    display: flex;
                    flex-direction: column;
                    align-items: flex-start;
                    justify-content: flex-start;
                    text-align: left;
                ">
                    <h3 style="font-size: 35px; margin: 0;">é‡å¤§æ±ºå®š Make Changes</h3>
                    <p style="margin: 0; font-size: 15px;">ID: 5 &nbsp;&nbsp;&nbsp; 40pts</p>
                    <p style="margin: 0; font-size: 20px;">
                        åŠ å…¥æˆ‘å€‘ä¸€èµ·æ”¹å–„æ•´å€‹æœå‹™! Join us and make this service even better! (æ­¤çé …ä¸å¯åœ¨ç¶²ç«™ä¸Šé ˜å–ï¼Œè«‹å¦æ´½ã€‚This perk is unavailable on this site, notify us to redeem.)
                    </p>
                </div>
            </div><br>
            <div class="boxxxxxx" style="display: flex; width: 100%; overflow: auto;">
                <div style="flex: 0 0 25%; max-width: 25%;">
                    <img src="perks/staffresume.svg" alt="Staff Resume" style="width: 100%;" class="perk-img">
                </div>
                <div style="
                    flex: 1;
                    margin-left: 20px;
                    display: flex;
                    flex-direction: column;
                    align-items: flex-start;
                    justify-content: flex-start;
                    text-align: left;
                ">
                    <h3 style="font-size: 35px; margin: 0;">å“¡å·¥é¢è©¦ Become Staff</h3>
                    <p style="margin: 0; font-size: 15px;">ID: 6 &nbsp;&nbsp;&nbsp; 45pts</p>
                    <p style="margin: 0; font-size: 20px;">
                        ä»¥æ­¤é¢è©¦æˆç‚ºå“¡å·¥çš„æ©Ÿæœƒï¼Œä¸€èµ·ç‚ºæ›´å¥½çš„é€±åˆŠæ•ˆå‹ã€‚A chance to become staff and make better magazines with us! (æ­¤çé …ä¸å¯åœ¨ç¶²ç«™ä¸Šé ˜å–ï¼Œè«‹å¦æ´½ã€‚This perk is unavailable on this site, notify us to redeem.)
                    </p>
                </div>
            </div><br>
            <div class="boxxxxxx" style="display: flex; width: 100%; overflow: auto;">
                <div style="flex: 0 0 25%; max-width: 25%;">
                    <img src="perks/holidayspec.svg" alt="Holiday Special" style="width: 100%;" class="perk-img">
                </div>
                <div style="
                    flex: 1;
                    margin-left: 20px;
                    display: flex;
                    flex-direction: column;
                    align-items: flex-start;
                    justify-content: flex-start;
                    text-align: left;
                ">
                    <h3 style="font-size: 35px; margin: 0;">å‡æœŸç‰¹åˆŠ Holiday Special</h3>
                    <p style="margin: 0; font-size: 15px;">ID: 7 &nbsp;&nbsp;&nbsp; 25pts</p>
                    <p style="margin: 0; font-size: 20px;">
                        ä»¥æ­¤å…Œæ›æš‘å‡å’Œå¯’å‡çš„ç¥ç§˜ç‰¹åˆ¥åˆŠ...? Get the special magazine for both summer and winter vacation...? (æœ‰å…è²»ç‰ˆåªæ˜¯å¾ˆæ©Ÿè»Šï¼Œä¸å®šæœŸæ›´æ–°ï¼Œåœ¨æœ€ç²¾å½©çš„åœ°æ–¹æ–·æ‰ã€‚Free ver. available, but it is updated inregularly and cuts off at "climaxes".)
                    </p>
                </div>
            </div><br>
            <div class="boxxxxxx" style="display: flex; width: 100%; overflow: auto;">
                <div style="flex: 0 0 25%; max-width: 25%;">
                    <img src="perks/blindbox.svg" alt="Blind Box" style="width: 100%;" class="perk-img">
                </div>
                <div style="
                    flex: 1;
                    margin-left: 20px;
                    display: flex;
                    flex-direction: column;
                    align-items: flex-start;
                    justify-content: flex-start;
                    text-align: left;
                ">
                    <h3 style="font-size: 35px; margin: 0;">ç¥ç§˜ç›²ç›’ Blind Box</h3>
                    <p style="margin: 0; font-size: 15px;">ID: 8 &nbsp;&nbsp;&nbsp; 30pts</p>
                    <p style="margin: 0; font-size: 20px;">
                        éš¨æ©Ÿå¾—åˆ°ä»¥ä¸Šçš„ç¦åˆ©ï¼Œæœ‰å¯èƒ½è™§ï¼Œä¹Ÿå¯èƒ½è³º! Take a risk and get a random perk! You may get perks not worth your points, or perks worth your points.
                    </p>
                </div>
            </div><br>
            <div class="boxxxxxx" style="display: flex; width: 100%; overflow: auto;">
                <div style="flex: 0 0 25%; max-width: 25%;">
                    <img src="perks/blindbox.svg" alt="Blind Box" style="width: 100%;" class="perk-img">
                </div>
                <div style="
                    flex: 1;
                    margin-left: 20px;
                    display: flex;
                    flex-direction: column;
                    align-items: flex-start;
                    justify-content: flex-start;
                    text-align: left;
                ">
                    <h3 style="font-size: 35px; margin: 0;">é»æ•¸å€æ•¸ Multiplier</h3>
                    <p style="margin: 0; font-size: 15px;">ID: 9 &nbsp;&nbsp;&nbsp; 30pts</p>
                    <p style="margin: 0; font-size: 20px;">
                        é»æ•¸éš¨æ©Ÿä¹˜ä»¥0.3åˆ°2å€ï¼Œä¸¦æŠŠå¾—åˆ°çš„é»æ•¸åœ¨ä¸€å€‹æœˆå…§ä¹˜ä»¥åŒæ•¸ã€‚Get your points multiplied between 0.3x to 2x, and have your points multiplied by the same amount for a month.
                    </p>
                </div>
            </div>
        </div>
        <br>
        <div class="boxxxxxx" style="width: 100%; text-align: left;">
            <h3>How to Get Points å¦‚ä½•å¾—åˆ°åˆ†æ•¸</h3>
            <p>* Good comments earn 1 to 2 point each! å¥½çš„ç•™è¨€å¯ç²å¾—ä¸€åˆ°å…©åˆ†ã€‚</p>
            <p>* Useful contributions earn 3 and more points each! å¥½çš„è²¢ç»å¯ç²å¾—ä¸‰åˆ†ä»¥ä¸Šã€‚</p>
            <p>* Reporting rule violators earn 10 points each! æª¢èˆ‰çŠ¯è¦é€™å¯å¾—ååˆ†ã€‚</p>
            <p>* Sellers in the market get 95% of each purchase. è³£å ´è³£å®¶å¯å¾—åˆ°95%çš„è²·å®¶è²»ç”¨ã€‚</p>
            <p>* Sellers need 1 point ad fee weekly, can remove the product for free. è³£å ´è³£å®¶éœ€ç¹³äº¤æ¯å‘¨1é»çš„å»£å‘Šè²»ï¼Œå¯åŠæ™‚æ’¤å›å•†å“ã€‚</p>
            <p>* Bad behavior loses scores! å£çš„è¡Œç‚ºæœƒæ‰£åˆ†ã€‚ (DEPENDS)</p>
            <p>* Comment spams lose 10 points! åƒåœ¾ç•™è¨€æ‰£ååˆ†ã€‚</p>
            <p>* Violating rules loses 50 points! é•è¦æœƒæ‰£äº”ååˆ†ã€‚</p>
            <p>* You can buy things in the market with the labeled price.å•†å ´ä¸­å¯ç”¨é»æ•¸è³¼è²·ä»–äººå•†å“ã€‚</p>
            <br>
            <p>* 5% interest every week! æ¯é€±é…5%çš„åˆ©æ¯! (å››æ¨äº”å…¥åˆ°å°æ•¸å¾Œ2ä½ Rounded to 2 decimal places)</p>
            <p>* 5% interest every week for loan. è²¸æ¬¾ï¼ˆè² åˆ†ï¼‰æ¯é€±æ”¶5%çš„åˆ©æ¯! (å››æ¨äº”å…¥åˆ°å°æ•¸å¾Œ2ä½ Rounded to 2 decimal places)</p>
            <br>
            <p> &rightarrow; How much scores depends. åŠ /æ‰£åˆ†çš„æ•¸é‡æœ‰æˆ‘æ–¹æ±ºå®šã€‚</p>
        </div>
        <br>
        <div class="boxxxxxx" style="width: 100%; text-align: left;">
            <h3>How to Redeem Points å¦‚ä½•å…Œæ›åˆ†æ•¸</h3>
            <p>1. Email <u>happy.ebook.staff@gmail.com</u></p>
            <p>2. Wait for us to reply. ç­‰å¾…æˆ‘å€‘å›è¦†ã€‚</p>
            <p>3. Use the secret code in the reply to redeem your perk. ç”¨å›è¦†è£¡çš„å¯†ç¢¼ä¾†å…Œæ›æ‚¨çš„ç¦åˆ©ã€‚</p>
            <br>
            <p> &rightarrow; The perk will only remain on the device you redeemed it with. ç¦åˆ©åªæœƒåœ¨ä½ å…Œæ›çš„è£ç½®ä¸Šå­˜åœ¨ã€‚</p>
            <p> &rightarrow; The secret code will expire within a week, so quickly redeem it. å¯†ç¢¼æœƒåœ¨ä¸€é€±å…§éæœŸï¼Œè«‹ç›¡å¿«å…Œæ›ã€‚</p>
        </div>
    </div>
</section>