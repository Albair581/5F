<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <meta name="viewport" content="width=device-width, initial-scale=1.0">
        <title>Happy Magazines</title>
        <link rel="shortcut icon" href="happy.png" type="image/x-icon">
        <link rel="stylesheet" href="style.css">
        <!-- Custom app icon (180x180 recommended for iOS) -->
        <link rel="apple-touch-icon" href="webapp.jpg">

        <link rel="manifest" href="manifest.json">

        <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
        <meta http-equiv="Pragma" content="no-cache" />
        <meta http-equiv="Expires" content="0" />
        <!-- Web app settings -->
        <meta name="mobile-web-app-capable" content="yes">
        <meta name="apple-mobile-web-app-title" content="Happy Magazines">
        <meta name="apple-mobile-web-app-status-bar-style" content="default">

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;700&family=Noto+Sans:wght@400;700&display=swap" rel="stylesheet">
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
        <script type="text/javascript"
        	src="https://cdn.jsdelivr.net/npm/@emailjs/browser@4/dist/email.min.js">
		</script>
		<script type="text/javascript">
   			(function(){
      			emailjs.init({
        				publicKey: "9fye_6JC17x7cHKOq",
      			});
   			})();
		</script>
    </head>
    <body class="light-mode">
        <!-- <div id="shutdown-overlay">
            <div class="message-box">
                <h1>⚠️ Website Shut Down</h1>
                <p>Hi! This website will be shut down from 2025/06/08 until 2025/06/20. Reason: GO REVIEW THE TEST</p>
                <h1>⚠️ 網站關閉中</h1>
                <p>您好，為不影響期末考試，本網站將從2025/06/08起暫時關閉，於2025/06/20重新開啟。</p>
                <h1>⚠️ ウェブサイト閉鎖のお知らせ</h1>
                <p>こんにちは！このウェブサイトは2025/06/08から2025/06/20まで閉鎖します。理由 テストを見直す</p>
            </div>
        </div> -->
        <!-- <style>
            #shutdown-overlay {
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(30, 30, 30, 0.9); /* Dark overlay */
                z-index: 9999;
                pointer-events: all; /* Capture all mouse events */
                display: flex;
                justify-content: center;
                align-items: center;
                color: white;
                font-family: sans-serif;
                text-align: left;
            }

            #shutdown-overlay .message-box {
                background: rgba(0, 0, 0, 0.6);
                padding: 2rem;
                border-radius: 10px;
                max-width: 90%;
                box-shadow: 0 0 15px rgba(0, 0, 0, 0.4);
            }

            body {
                overflow: hidden; /* Disable scrolling */
            }

        </style> -->
        <!-- <script>
            (function() {
                const normalOverlayId = 'shutdown-overlay';
                const sassOverlayId = 'angry-overlay';
                let roasted = false;

                function createAngryOverlay() {
                    if (document.getElementById(sassOverlayId)) return;

                    const angry = document.createElement('div');
                    angry.id = sassOverlayId;
                    angry.style = `
                        position: fixed;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: rgba(0, 0, 0, 0.95);
                        color: white;
                        z-index: 999999;
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        text-align: center;
                        font-family: sans-serif;
                        pointer-events: all;
                        padding: 2rem;
                    `;
                    angry.innerHTML = `
                        <div>
                            <h1>💻 No, no and a final NO.</h1>
                            <p>Don't think removing some divs and styles makes you a pro hacker. Honestly, you suck.</p>
                            <p>DevTools are for REAL developers. Not keyboard cowboys like you.</p>
                            <p>Refresh the page before we do it for you. You've been logged. 🚓</p>
                            <p>Refrehsing the website in 5 seconds. 💥</p>
                        </div>
                    `;
                    document.body.appendChild(angry);
                }

                const observer = new MutationObserver(() => {
                    const overlay = document.getElementById(normalOverlayId);
                    if (!overlay && !roasted) {
                        roasted = true;

                        console.warn("%c🛑 Hey you!", "color: red; font-size: 18px; font-weight: bold;");
                        console.warn("%cRemoving the overlay doesn't make you a pro hacker.", "color: white; font-size: 14px;");
                        console.warn("%cDevTools are for debugging, not your career dreams. 😤", "color: gray; font-size: 14px;");

                        createAngryOverlay();

                        // Auto-refresh in 5 seconds for extra pettiness
                        setTimeout(() => {
                            console.log("You had your fun. We're done here.");
                            location.reload();
                        }, 5000);
                    }
                });

                observer.observe(document.body, { childList: true, subtree: true });

                // Optional: Block right click and keyboard shortcuts
                window.addEventListener('contextmenu', e => e.preventDefault());
                window.addEventListener('keydown', e => {
                    if (
                        ['F12', 'I', 'J', 'U', 'S'].includes(e.key.toUpperCase()) &&
                        (e.ctrlKey || e.metaKey)
                    ) {
                        e.preventDefault();
                    }
                }, true);
            })();
        </script> -->


        <!-- Navigation Bar -->
        <nav class="navbar">
            <div class="navbar-container">
                <a href="#" class="navbar-brand" data-i18n="name">開心週刊</a>
                <button class="navbar-toggler" aria-label="Toggle navigation">
                    <i class="fas fa-bars"></i>
                </button>
                <div class="navbar-collapse">
                    <ul class="navbar-nav">
                        <li class="nav-item"><a href="#home" class="nav-link active" data-i18n="home">主頁</a></li>
                        <li class="nav-item"><a href="#ebooks" class="nav-link" data-i18n="ebooks">電子書</a></li>
                        <li class="nav-item"><a href="#courses" class="nav-link" data-i18n="course">課程</a></li>
                        <li class="nav-item"><a href="#you" class="nav-link" data-i18n="you">YOU</a></li>
                        <li class="nav-item"><a href="#market" class="nav-link" data-i18n="market">商場</a></li>
                        <li class="nav-item"><a href="#app" class="nav-link" data-i18n="app">應用程式</a></li>
                        <li class="nav-item"><a href="#credits" class="nav-link" data-i18n="credits">致謝</a></li>
                        <li class="nav-item"><a href="#settings-modal" class="ns" data-i18n="settings" id="settings-link">設定</a></li>
                    </ul>
                </div>
            </div>
        </nav>

        <!-- Hero Section -->
        <section class="hero">
            <div class="hero-image">
                <!-- <img src="https://images.unsplash.com/photo-1526243741027-444d633d7365?q=80&w=1742&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Books on shelf"> -->
                <!-- change styles.css back -->
                <!-- MARK: Reset CSS + Remove -->
                <img src="https://images.unsplash.com/photo-1503676260728-1c00da094a0b?q=80&w=2022&auto=format&fit=crop&ixlib=rb-4.1.0&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D" alt="Desk"> <!-- style="--x-offset: 50%; --y-offset: 71%;" -->
                <script>
                </script>
                <div class="hero-overlay">
                    <br><br><br>
                    <h1 data-i18n="name">開心週刊</h1>
                </div>
            </div>
        </section>

        <!-- Main Content -->
        <main class="container">
            <div id="page-content"></div>
        </main>

        <!-- Settings Modal -->
        <div class="modal" id="settings-modal">
            <div class="modal-content">
                <span class="close-modal">&times;</span>
                <h2 data-i18n="settings">設定</h2>
                <div class="setting-option">
                    <label for="dark-mode-toggle" data-i18n="dark-mode">深色頁面</label>
                    <label class="switch">
                        <input type="checkbox" id="dark-mode-toggle">
                        <span class="slider round"></span>
                    </label>
                </div>
                <div id="custom-hero-upload" style="display: none;">
                    <br>
                    <hr>
                    <br>
                    <label data-i18n="hero-image-file">🌄 Upload your own hero image (file):</label><br>
                    <label for="hero-image-input" class="custom-file-upload" data-i18n="hero-browse-file">
                        Browse
                    </label>
                    <input id="hero-image-input" type="file" accept="image/*" style="display:none;">
                    <br><br>

                    <label data-i18n="hero-image-url">🌐 Or use a URL:</label><br>
                    <input type="text" id="hero-image-url" placeholder="https://example.com/image.jpg"><br>
                    <button id="apply-hero-url" style="margin-top: 5px">OK</button><br><br>

                    <label for="x-offset-slider">↔️ Horizontal Position:</label><br>
                    <input type="range" id="x-offset-slider" min="0" max="100" value="50"><br>

                    <label for="y-offset-slider">↕️ Vertical Position:</label><br>
                    <!-- MARK: RESET TO 50 -->
                    <input type="range" id="y-offset-slider" min="0" max="100" value="50"><br><br><br>

                    <button id="reset-hero-image" data-i18n="reset-hero-image">🔄 Reset to default</button>
                </div>
                <br>
                <hr>
                <br>
                <label for="language-select" data-i18n="change-language">Language</label><br>
                <select id="language-select" class="language-selector">
                    <option value="en">English</option>
                    <option value="zh">中文</option>
                    <option value="jp">日本語</option>
                </select>
                <br><br>
                <hr>
                <br>
                <a href="https://discord.gg/krmMrm6pHU" target="_blank" data-i18n="discord-server">Our Discord Server</a>
                <br>
                <p id="noinstall">Your device doesn't support the auto-install feature. 您的裝置不支援自動安裝功能。お使いのデバイスは自動インストール機能をサポートしていません。</p>
                <button id="installBtn" style="display:none;">📲 Install 安裝 インストール</button>
                <br class="refresh-break" style="display: none;"><br class="refresh-break" style="display: none;">
                <p style="display: none;" id="refresh-reminder" data-i18n="refresh-rem">Close and reopen this APP frequently to get the latetst updates. We can't do it for you on mobile because of regulations. Another reason is that Albert is simply too lazy do research on how to do it for you, so...</p>
            </div>
        </div>


        <!-- MARK: RESET TO 50 -->
        <script>
            function updateHeroPosition(x, y) {
                $(".hero-image img").css("--x-offset", x + "%").css("--y-offset", y + "%");
                localStorage.setItem("heroOffsetX", x);
                localStorage.setItem("heroOffsetY", y);
            }

            $("#x-offset-slider, #y-offset-slider").on("input", function () {
                const x = $("#x-offset-slider").val();
                const y = $("#y-offset-slider").val();
                updateHeroPosition(x, y);
            });

            // MARK: Reset to 50
            // Apply saved offsets on page load
            localStorage.setItem("heroOffsetY", 60);
            const savedX = localStorage.getItem("heroOffsetX") || 50;
            // const savedY = localStorage.getItem("heroOffsetY") || 71;
            const savedY = localStorage.getItem("heroOffsetY") || 50;
            updateHeroPosition(savedX, savedY);

            // Also update sliders on page load
            $("#x-offset-slider").val(savedX);
            $("#y-offset-slider").val(savedY);


            $(document).ready(function () {
                const heroImage = $(".hero-image img");
                const websiteskinData = localStorage.getItem("websiteskin");

                let parsedSkin = null;
                try {
                    parsedSkin = JSON.parse(websiteskinData);
                } catch (e) {
                    console.warn("Invalid websiteskin JSON");
                }

                // 1. Check if we should show the upload section
                if (parsedSkin && parsedSkin.quantity > 0) {
                    $("#custom-hero-upload").show();
                }

                // 2. Load custom image from localStorage if exists
                const storedHeroImage = localStorage.getItem("customHeroImage");
                if (storedHeroImage) {
                    heroImage.attr("src", storedHeroImage);
                }

                // 3. File upload handling
                $("#hero-image-input").on("change", function () {
                    const file = this.files[0];
                    if (!file) return;

                    const reader = new FileReader();
                    reader.onload = function (e) {
                        const imageUrl = e.target.result;
                        heroImage.attr("src", imageUrl);
                        localStorage.setItem("customHeroImage", imageUrl);
                    };
                    reader.readAsDataURL(file);
                });

                // 4. URL input handling
                $("#apply-hero-url").on("click", function () {
                    const url = $("#hero-image-url").val().trim();

                    // Allow either a real URL or a data:image base64 string
                    const isValidImage = /^https?:\/\/.+/i.test(url) || /^data:image\/.+;base64,/i.test(url);

                    if (!isValidImage) {
                        alert("Please enter a valid image URL or base64 image data. 無法讀取圖片。");
                        return;
                    }

                    // Test the image by trying to load it
                    const testImg = new Image();
                    testImg.onload = function () {
                        $(".hero-image img").attr("src", url);
                        localStorage.setItem("customHeroImage", url);
                        alert("✅ Hero image updated! 成功更換圖片!");
                    };
                    testImg.onerror = function () {
                        alert("❌ Failed to load the image. Please check your link or base64 data. 無法讀取圖片。");
                    };
                    testImg.src = url;
                });

                // 5. Reset button
                $("#reset-hero-image").on("click", function () {
                    localStorage.removeItem("customHeroImage");
                    localStorage.removeItem("heroOffsetX");
                    localStorage.removeItem("heroOffsetY");
                    $(".hero-image img")
                        .attr("src", "https://images.unsplash.com/photo-1526243741027-444d633d7365?q=80&w=1742&auto=format&fit=crop&ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D")
                        .css("--x-offset", "50%")
                        .css("--y-offset", "50%");
                    $("#x-offset-slider").val(50);
                    $("#y-offset-slider").val(50);
                });
            });
            </script>


        

        <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.2/dist/confetti.browser.min.js"></script>
        <script src="translation.js"></script>
        <script src="script.js"></script>

        <script>
            let deferredPrompt;  

            const isPWA = window.matchMedia('(display-mode: standalone)').matches || window.navigator.standalone === true;

            if (isPWA) {
                $("#refresh-reminder").show();
                $(".refresh-break").show();
            } else {
                $("#refresh-reminder").hide();
                $(".refresh-break").hide();
            }

            function isAndroidChrome() {
                const ua = navigator.userAgent.toLowerCase();
                console.log(ua);
                return ua.includes("chrome") || ua.includes("edge");
            }

            window.addEventListener('beforeinstallprompt', (e) => {
                // Prevent Chrome's default mini-infobar
                e.preventDefault();
                deferredPrompt = e;

                if (isAndroidChrome()) {
                    const noinstall = document.getElementById('noinstall');
                    noinstall.style.display = 'none';
                    const installBtn = document.getElementById('installBtn');
                    installBtn.style.display = 'inline-block';

                    installBtn.addEventListener('click', () => {
                        installBtn.style.display = 'none'; // Hide after click
                        deferredPrompt.prompt();

                        deferredPrompt.userChoice.then((choiceResult) => {
                            if (choiceResult.outcome === 'accepted') {
                                console.log('✅ User accepted the install prompt');
                            } else {
                                console.log('❌ User dismissed the install prompt');
                            }
                            deferredPrompt = null;
                        });
                    });
                }
            });
        </script>

        <script>
            window.addEventListener("load", () => {
                const duration = 3 * 1000; // 3 seconds
                const animationEnd = Date.now() + duration;

                (function frame() {
                    confetti({
                    particleCount: 4,
                    angle: 60,
                    spread: 100,
                    origin: { x: 0 }
                    });
                    confetti({
                    particleCount: 4,
                    angle: 120,
                    spread: 100,
                    origin: { x: 1 }
                    });

                    if (Date.now() < animationEnd) {
                        requestAnimationFrame(frame);
                    }
                })();
            });
        </script>
    </body>
</html>